[TOC]

## 一、概述

[第五章]()介绍了贝塞尔曲线，它是一种比较简单的曲线，通过固定数量的控制点可以很容易的得到一条平滑曲线。

但贝塞尔曲线有时很难逼近某些复杂曲线的形状，尤其在控制点数量较少的情况下，而高阶贝塞尔曲线的计算又会提高计算复杂度，降低实现效率。此外，对贝塞尔曲线某个控制点的更改，会影响整体形状的变更。

（示意图）

### 1.1 灵活控制曲线的尝试（待定）

针对复杂图形，可以切割贝塞尔曲线，更好地控制曲线形状。这是可行的，但复杂在需要控制拼接点的曲线平滑度（连续性），而这个过程效率非常低下。

（示意图）

* 推导
* 重复点需化简

### 1.2 引入 *B-Spline* 曲线

由于贝塞尔曲线存在以上局限性，因此引入了**B样条曲线（*B-Spline Curves*）**。

> 准确来说，*B-Spline*曲线是贝塞尔曲线的一般化，贝塞尔曲线是*B-Spline*曲线的特殊情况。

（B-Spline示意图）

上图所示为一条三阶 *B-Spline* 曲线， 它的控制点共有8个。换个角度看，它实际上是由5个三阶贝塞尔曲线组合而成，也就是说，使用 *B-Spline* 曲线不会增加阶数（虽然控制点很多），无需刻意控制拼接点的连续性，而且拥有了前面所说切割贝塞尔曲线方法得到的灵活控制性。

> *B-Spline* 曲线的灵活性就来源于低阶曲线可以有更多的控制点，而贝塞尔曲线的阶数和控制点数量比非常小，因此控制点越多，阶数越多，计算越复杂，这也是 *B-Spline* 曲线相比贝塞尔曲线的本质优势。

从几何层面切割曲线是很复杂的，由于不在乎切割点的具体几何位置，因此通常按照参数作用域进行切割，例如参数的作用域为 $[0,1]$ ，定义<span id="断点">**断点（*Breakpoint*）**</span>，则每个断点的位置为 $0\lt u_0\lt u_1\lt u_2 \lt...\lt u_m\lt1$ 。

总的来说，一条 *B-Spline* 曲线是由一组控制点，一组结点和一组系数进行控制的。其中系数的计算是最重要的，因为系数是保证多条曲线连接时连续性的保证。

## 二、*B-Spline* 基函数

*B-Spline* 比起贝塞尔曲线的基函数（伯恩斯坦多项式）更复杂，并且有额外的两条性质：

* 作用域被结点分割。
* 基函数在整个作用域区间不是全部非零的，更准确地说，仅在部分相邻区间是非零的。

令 $U$ 为 $m+1$ 个非递减数 $u_0\le u_1\le...\le u_m$ 的集合，其中 $u_i$ 被称为<span id="结点">**结点（*Knot*）**</span>， $U$ 被称为**结点向量（*Knot Vector*）**，半开区间 $[u_i,u_{i+1})$ 为**第 $i$ 个结点跨度（*$i$-th knot span*）**。

上述定义中，可能存在 $u_i=u_j$ （因为 $u_i$ 不唯一）的情况，因此有些结点跨度是不存在的。若某个 $u_i$ 出现 $k$ 次（$k>1$，则称该 $u_i$ 为**多重结点（*Multiple Knot*）**，**重复数（*Multiplicity*）**为 $k$ 。若某个 $u_i$ 仅出现一次，则称之为**简单结点（*Simple Knot*）**。

如果每个结点跨度均相等，则称结点向量为**均匀的（*Uniform*）**，否则为**不均匀的（*Non-uniform*）**。

所有 *B-Spline* 基函数应该有其自己的作用域 $[u_0,u_m]$ ，本文仅考虑 $u_0=0,u_m=1$ 的情况，因此作用域均为 $[0,1]$ 。

则由 $i$ 条贝塞尔曲线组成的 $p$ 阶 *B-Spline* 基函数定义如下：
$$
\begin{align}
N_{i,0}(u)&=
\begin{cases}
1\ \ \ \ \ if\ u_i\le u\le u_{i+1},\\ \\
0\ \ \ \ \ otherwise
\end{cases}\\ \\
N_{i,p}(u)&=\frac{u-u_i}{u_{i+p}-u_i}N_{i,p-1}(u)+\frac{u_{i+p+1}-u}{u_{i+p+1}-u_{i+1}}N_{i+1,p-1}(u)
\end{align}
$$

上述表达式就是***Cox-de Boor* 递推公式（*Cox-de Boor recursion formula*）**。

* $N_{i,0}$ 公式表明，当 $u$ 超出 $[u_i,u_{i+1}]$ 范围时，系数为 $0$ 。
* $N_{i,p}$ 公式表明，第 $i$ 段曲线 $p$ 阶系数由**第 $i$ 段曲线 $p-1$ 阶系数**和**第 $i+1$ 段曲线 $p-1$ 阶系数**计算得出，即上述两个系数的线性组合。
* 计算时，只需计算到下标 $i+p+1$ 的值等于 $m$ 即可。

> 在前面定义了两个概念：[断点](#断点)和[结点](#结点)，二者分别定义为几何结点和代数结点（我自己定义的）。
>
> 由于在图形中，如果断点相同，则两个点重合，两个断点之间不存在曲线段，完全可以删除某个断点；但是在数学讨论时，带有重合意义的结点的相关计算是有意义的，因此衍生出了断点和结点两个含义：
>
> * 断点表示集合 $U$ 的互不相同（*Distinct*）的元素。
> * 结点作为集合 $U$ 的元素，可存在相同值。
>
> 实际需要根据语义区分。

上述公式可以采用截断三角形表（*Truncated triangular table*）进行计算。

（图片）

> 这是一种很重要的表示和计算方式，之后的很多性质讨论结合该表进行证明和思考会更容易理解。




## 参考文献

[*Dr. C.K. Shene, Unit 6 of The Geometry Notes of Michigan Technological University.*](https://pages.mtu.edu/~shene/COURSES/cs3621/NOTES/)

[*Les Piegl, Wayne Tiller, The NURBS Book (Second Edition).*](https://link.springer.com/book/10.1007/978-3-642-97385-7)

