[TOC]

## 一、贝塞尔曲线（*Bézier Curves*）

贝塞尔曲线是图形学中非常常用的曲线，非常高频的用于矢量图绘制及建模中。

对于曲线来说，前面提到过参数方程可以有不同形式表示的同一个曲线，因此接下来介绍的贝塞尔曲线和前面所说的基础多项式形式数学层面是相同的，只是参数的选择不同。

### 1.1 定义

**贝塞尔曲线（*Bézier Curves*）**的定义式为：
$$
\bold{C}(u)=\Sigma_{i=0}^nB_{i,n}(u)\bold{P_i}\ \ \ \ \ \ \ \ \ \ 0\le u\le 1
$$
其**基函数** $B_{i,n}$ 就是**伯恩斯坦多项式（*Bernstein Polynomials*）**：
$$
\begin{align}
B_{i,n}&=\binom{n}{i}u^i(1-u)^{n-i}\\
&=\frac{n!}{i!(n-i)!}u^i(1-u)^{n-i}
\end{align}
$$
贝塞尔曲线的 $P_i$ 被称为曲线的控制点，$n$ 为阶数。

> 基函数通常用于计算系数作为基底，例如坐标轴 $x,y$ 就是最简单的正交基底，函数空间中的任意连续函数可以看做是基函数的线性组合，就像向量空间中任意向量都可以看做是基向量的线性组合一样。

#### （列举一阶、二阶、三阶，并附图）

### 1.2 性质

贝塞尔曲线有以下几个较重要的性质（未完整列举所有性质）：

* <span id="性质一">性质一</span>：**端点性质**

  $n$ 阶多项式有 $n+1$ 个控制点，且首尾控制点恰好为曲线起点与终点，$B_{0,n}(0)=B_{n,n}(1)=1$ ，并且首尾控制点所在线段与曲线相切；

* 性质二：**凸包性质**

  贝塞尔曲线始终会在**包含了所有控制点的最小[凸多边形](https://zh.wikipedia.org/zh-hk/%E5%87%B8%E5%A4%9A%E8%BE%B9%E5%BD%A2)**中，注意并非所有控制点都在凸多边形的边界上；

* 性质三：**变化递减性质**

  贝塞尔曲线的几何复杂度一定小于多项式得到的控制点与控制线段的几何复杂度；

* 性质四：**仿射不变性**

  贝塞尔曲线经过仿射变换后，可以被经过同样的仿射变换的控制点表示；

* 性质五：**系数非负性**

  $B_{i,n}(u)>=0$ 对所有 $i$ ， $n$ 且 $0\le u\le 1$成立；

* 性质六：**系数之和**

  系数之和 $\Sigma B_{i,n}(u)=1$ ：
  $$
  \sum_{i=0}^n B_{i,n}(u)=\sum_{i=0}^n\binom{n}{i}u^i(1-u)^{n-i}\xlongequal[]{二项式定理}(u + (1-u))^n=1^n=1
  $$

* <span id="性质七">性质七</span>：**最大值**

  $B_{i,n}(u)$ 在 $[0,1]$ 区间当且仅当 $u=\frac{i}{n}$ 时有唯一最大值；

* 性质八：**系数对称**

  对于任意 $n$ ，多项式 $B_{i,n}(u)$ 的曲线（以 $u$ 为横坐标）集合始终关于 $u=\frac{1}{2}$ 对称，也因此，将**控制点的顺序反转能够得到相同的曲线**；

* <span id="性质九">性质九</span>：**系数递归性**（本质）
  $$
  \begin{align}
  &B_{i,n}(u)=(1-u)B_{i,n-1}(u)+uB_{i-1,n-1}(u)\\ \\
  &备注：定义\ i\lt0\ 或\ i\gt n\ 时： B_{i,n}(u)\equiv0
  \end{align}
  $$
  <span style="color:red">证明</span>

* <span id="性质十">性质十</span>：**系数一阶导数**
  $$
  \begin{align}
  B_{i,n}^{'}(u)&=\frac{dB_{i,n}(u)}{du}\\
  &=n(B_{i-1,n-1}(u)-B_{i,n-1}(u))\\ \\
  备注：当\ i=0\ 时，&有\ B_{-1,n-1}(u)\equiv B_{n,n-1}(u)\equiv 0
  \end{align}
  $$
  <span style="color:red">证明</span>



### 1.3 贝塞尔曲线的导数

由伯恩斯坦多项式的[性质十](#性质十)可推导出贝塞尔曲线的导数：
$$
\begin{align}
\bold{C'}(u)&=\frac{d\bold{C(u)}}{du}=\Sigma_{i=0}^{n}\frac{dB_{i,n}(u)}{du}\bold{P_i}\\ \\
&=\Sigma_{i=0}^{n-1}B_{i,n-1}[(n(\bold{P_{i+1}-\bold{P_i}})]
\end{align}
$$
可以看到 $\bold{C'}(u)$ 仍然是一个贝塞尔曲线，阶数为 $n-1$ （ $n$ 为原曲线的阶数），其控制点为 $n(\bold{P_{i+1}}-\bold{P_i})$ 。该曲线通常被称为原曲线的速度线，常用于贝塞尔曲线的拼接。

当 $u=u_0$ 时， 向量 $\bold{C'}(u_0)$ 为曲线上该点的**切向量**。

### 1.4 区间变换

贝塞尔曲线的参数区间可能不是 $[0,1]$ 而是 $[a,b]$ ，此时只需要进行如下变换：
$$
\underline{u}=\frac{u-a}{b-a}
$$
并带入多项式：
$$
B_{i,n}(u)=\frac{n!}{i!(n-i)!}(\frac{u-a}{b-a})^i(1-\frac{u-a}{b-a})^{n-i}
$$

### 1.7 贝塞尔曲线的高阶导数（待定）

* 多项式求高阶导数



## 二、迪杰斯特拉算法（*DeCasteljau's Algorithm*）

有了贝塞尔曲线的公式，画出贝塞尔曲线只需要从 $[0,1]$ 取多个 $u$ ，得到曲线上的多个点 $C(u)$ ，然后画出曲线即可，曲线的光滑度与计算得到的点的稀疏度有关。

但是根据原始公式计算需要多次求和，且每次求和都要有多个阶乘和指数运算，因此效率会非常低。所以，我们来看下经典贝塞尔曲线的算法：迪杰斯特拉算法（*DeCasteljau's Algorithm*）。

### 2.1 算法推导

假设有以下二阶贝塞尔曲线及控制点：

（图片）

对其公式展开：
$$
\begin{align}
\bold{C}(u)&=\Sigma_{i=0}^2B_{i,2}(u)\bold{P_i}\\ \\
&=(1-u)^2\bold{P_0}+2u(1-u)\bold{P_1}+u^2\bold{P_2}\\ \\
&=\underline{(1-u)(\underline{(1-u)\bold{P_0}+u\bold{P_1}})+u(\underline{(1-u)\bold{P_1}+u\bold{P_2}})}
\end{align}
$$
可以看到对于曲线上的点 $\bold{C}(u)$ ，可以先根据两个一阶贝塞尔曲线得到直线 $\bold{P_1-P_0}$  和 $\bold{P_2-P_1}$ 两个直线上的点：

（图片）

然后对这两个点的连线同样进行一阶贝塞尔曲线的运算，最终能够得到曲线上的目标点 $\bold{C}(u)$：

（图片）

将贝塞尔曲线推广后，得到 $n$ 阶贝塞尔曲线的<span id="2.1">变形公式</span>：
$$
\bold{C_n}(\bold{P_0,...,P_n})=(1-u)\bold{C_{n-1}}(\bold{P_0,...,P_{n-1}})+u\bold{C_{n-1}}(\bold{P_1,...,P_n}) \tag{2.1}
$$
> 实际上也可以通过[伯恩斯坦多项式的递归性](#性质九)推导得出

这是一个递归式，递归终点是求一阶贝塞尔曲线。

（几何意义 图片）

其中 $\bold{C_{n-1}}(\bold{P_0,...,P_{n-1}})$ 和 $\bold{C_{n-1}}(\bold{P_1,...,P_n})$ 为**辅助控制点**，为了方便记录，现在使用两个下标值（例如 $P_{00}$ ）记录辅助控制点：

* 原本的控制点 $P_0,P_1,...,P_n$ ，统一认为是 $P_{0,0},P_{0,1},...,P_{0,n}$ ；

* 对于变形后的递归式中得到的辅助控制点，我们假设某辅助控制点由 $\bold{P_{i,\ j}}$ 和 $\bold{P_{i,\ j+1}}$ 得到（即在二者连线上），则记该辅助控制点为 $\bold{P_{i+1,\ j}}$。

则根据递归式，且固定 $u=u_0$ 时，可以得到以下对每个**辅助控制点**的求解算法：
$$
\bold{P_{k,i}}(u_0)=(1-u_0)\bold{P_{k-1,i}}(u_0)+u_0\bold{P_{k-1,i+1(u_0)}}\ \ \ \ \ \ for
\begin{cases}
\begin{align}
k&=1,2,...n\\
i&=0,1,...n-k
\end{align}
\end{cases}
$$
上述算法即为迪杰斯特拉算法，最后得到的 $P_{n,0}$ 即为贝塞尔曲线上的点，通过不断调整 $u$ ，最终能够得到多个点序列，并根据这些点得到目标曲线。

### 2.2 算法几何描述

定义一个迭代点表格，则有：

（图片）



### 2.3 算法实现

迪杰斯特拉算法的迭代方式实现：



递归方式实现：



### 2.4 迪杰斯特拉算法的性质

对贝塞尔曲线的导数变形，可以得到如下表达式：
$$
\begin{align}
\bold{C'}(u)&=\Sigma_{i=0}^{n-1}B_{i,n-1}(u)(n(\bold{P_{i+1}-\bold{P_i}}))\\ \\
&=n\left[ (\Sigma_{i=0}^{n-1}B_{i,n}(u)\bold{P_{i+1}})-(\Sigma_{i=0}^{n-1}B_{i,n}(u)\bold{P_{i}}) \right]\\ \\
\end{align}
$$
其中：
$$
\begin{align}
\bold{C_{n-1}}(\bold{P_1,P_2,...,P_n})&=\Sigma_{i=0}^{n-1}B_{i,n}(u)\bold{P_{i+1}}\\
\bold{C_{n-1}}(\bold{P_0,P_1,...,P_{n-1}})&=\Sigma_{i=0}^{n-1}B_{i,n}(u)\bold{P_{i}}
\end{align}
$$
则有：
$$
\bold{C'}(u)=n[ \bold{C_{n-1}}(\bold{P_1,P_2,...,P_n})-\bold{C_{n-1}}(\bold{P_0,P_1,...,P_{n-1}})]
$$
由[表达式-$2.1$](#2.1)可知曲线上的点 $\bold{C}(u)$ 在向量 $\bold{C_{n-1}}(\bold{P_1,P_2,...,P_{n}})-\bold{C_{n-1}}(\bold{P_0,P_1,...,P_{n-1}})$ 所在线段上：



综上，可得到结论：

**迪杰斯特拉算法的最后一个辅助控制点（即曲线上的所求点）所在控制线段与曲线相切，切点为该辅助控制点（即曲线上的所求点）。**

### 2.5 贝塞尔曲线高阶导数求解方式优化（待定）

* 迪杰斯特拉算法求高阶导数

## 三、贝塞尔曲线的基础变换

### 3.1 控制点移动

现有一条贝塞尔曲线：
$$
\bold{C}(u)=\Sigma_{i=0}^nB_{i,n}(u)\bold{P_i}
$$


固定其他控制点，只移动某一个控制点 $\bold{P_k}$ 到 $\bold{P_k}+\bold{v}$ 时，能够得到一条新的曲线：
$$
\begin{align}
\bold{D}(u)&=\Sigma_{i=0}^{k-1}B_{i,n}(u)\bold{P_i}+B_{k,n}(u)(\bold{P_k}+\bold{v})+\Sigma_{i=k+1}^nB_{i,n}(u)\bold{P_i}\\ \\
&=\Sigma_{i=0}^nB_{i,n}(u)\bold{P_i}+B_{k,n}(u)\bold{v}\\ \\
&=\bold{C}(u)+B_{k,n}(u)\bold{v}
\end{align}
$$
新曲线 $\bold{D}(u)$ 为原曲线 $\bold{C}(u)$ 上的**每个点朝着 $\bold{v}$ 的方向移动距离 $|B_{k,n}(u)\bold{v}|$**，每个点的**移动距离与参数 $u$ 相关**。由[性质七](#性质七)可知在 $u=\frac{1}{2}$ 时移动的距离最大。

（图片）

可以看出，贝塞尔曲线某个控制点的移动会导致整体形状偏移，牵一发而动全身。

### 3.2 贝塞尔曲线的拼接

假设现在有两条曲线 $\bold{C}(u)$ 和 $\bold{D}(u)$ ，分别由控制点 $\bold{P_0,P_1,...,P_m}$ 和 $\bold{Q_0,Q_1,...,Q_n}$ 表示。

二者拼接时，应有 $\bold{P_m}=\bold{Q_0}$ （假设后者拼接到前者），这个等式说明拼接点是 $C^0$ 连续的，又由[性质一](#性质一)可知，$\bold{P_m}$ 和 $\bold{Q_0}$ 所在线段与曲线相切，因此只要 $\bold{P_{m-1},P_m,Q_0,Q_1}$ 共线即可保证拼接点是 $G^1$ 连续的。

要保证拼接点 $C^1$ 连续，应有如下等式：
$$
\bold{C'}(1)=m(\bold{P_m}-\bold{P_{m-1}})=\bold{D'}(0)=n(\bold{Q_1}-\bold{Q_0})
$$
要满足这个等式，需要线段长度 $|\bold{P_m-P_{m-1}}|$ 和 $|\bold{Q_1}-\bold{Q_0}|$ 的比例为 $\frac{n}{m}$ ，即：
$$
\frac{|\bold{P_m-P_{m-1}}|}{|\bold{Q_1}-\bold{Q_0}|}=\frac{n}{m}
$$

> 如果某个曲线闭合，则将上述 $\bold{Q_0,Q_1}$ 换为 $\bold{P_0,P_1}$ 即可。

### 3.3 贝塞尔曲线的切割

切割意味着我们期望将贝塞尔曲线在某个点 $\bold{C}(u_0)$ 切割为两条贝塞尔曲线，原贝塞尔曲线**除了起点和终点外，其他所有点都将废弃**，新的两条贝塞尔曲线**拥有各自全新的控制点**。除此之外，**新的贝塞尔曲线是原贝塞尔曲线的子集，且必须与原曲线阶数相同**。

实际上，贝塞尔曲线切割后的两条曲线的控制点，可以由迪杰斯特拉算法推导得出。

切割算法描述如下：

**贝塞尔曲线 $\bold{C(P_0,P_1,...P_n)}$ 经过点 $\bold{C}(u_0)$ 切割后，得到的新的两条曲线分别为 $\bold{C(P_{0,0},P_{1,0},...,P_{n,0})}$ 和 $\bold{C(P_{n,0},P_{n-1,1},P_{n-2,2}...,P_{0,n})}$ ，其中的点均为迪杰斯特拉算法中定义的辅助控制点。** 

（图片）

#### 3.3.1 切割算法的正确性证明（待定）

[证明过程](https://pages.mtu.edu/~shene/COURSES/cs3621/NOTES/spline/Bezier/b-sub-correct.html)

* 计算新曲线的点的表达式
* 证明新曲线的点为原曲线的部分，由切割点切割

### 3.4贝塞尔曲线的阶数提升

虽然贝塞尔曲线的阶数越高，其处理效率也随之下降，但高阶贝塞尔曲线可以更灵活的控制曲线形状。该小节会介绍如何将某个形状的贝塞尔曲线的阶数提升且**不改变曲线形状和位置**。

> 如果阶数提升的同时改变了曲线形状，则这个过程并不能称为阶数提升，而是绘制了新的曲线。

阶数提升算法描述如下：

**现有一条 $n$ 阶贝塞尔曲线，其控制点为 $\bold{P_0,P_1,...,P_n}$ ，将该曲线的阶数提升为 $n+1$ ，并且新的控制点为 $\bold{Q_0,Q_1,...Q_{n+1}}$ ，应有 $\bold{Q_0}=\bold{P_0}$ 和 $\bold{Q_{n+1}}=\bold{P_n}$ ，其他新的控制点**对应关系如下：
$$
\bold{Q_i}=\frac{i}{n+1}\bold{P_{i-1}}+\left( 1-\frac{i}{n+1}\bold{P_i} \right)\ \ \ \ \ 1\le i\le n \tag{4.1}
$$
由上述表达式可以得知， $\bold{Q_i}$ 位于线段 $P_{i-1}P_i$ 上，且 $\bold{Q_i}$ 将线段划分为两个子线段，子线段长度比为 $\frac{i}{n+1}$ 和 $1-\left( 1-\frac{i}{n+1} \right)$。

（图片）

#### 3.4.1 阶数提升算法的正确性证明（待定）

[证明过程](https://pages.mtu.edu/~shene/COURSES/cs3621/NOTES/spline/Bezier/deg-elev-correct.html)

* 图像形状相同只需要其所有导数在固定点均相等即可。
* 若上述证明成立，确定了起点与终点位置后，其位置也将和原曲线完全相同。
* 使用数学归纳法。



